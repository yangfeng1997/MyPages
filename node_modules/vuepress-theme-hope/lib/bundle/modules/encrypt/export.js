import{keys as S,isPlainObject as w,startsWith as O,RenderDefault as _}from"@vuepress/helper/client";import{defineComponent as f,ref as m,computed as d,h as s,nextTick as V,onMounted as E}from"vue";import{usePageFrontmatter as x,usePageData as C}from"vuepress/client";import{y as D,F as G}from"../../PageTitle-d0jpQcnn.js";import{L as H}from"../../icons-BBxJRXot.js";import"./styles/password-modal.scss";import{u as I,c as K,d as R}from"../../PageInfo-BsNQ7UP4.js";import{useStorage as b,useSessionStorage as g}from"@vueuse/core";import{compareSync as y}from"bcrypt-ts/browser";import"@vuepress/helper/transition/fade-in-up.css";import"../../styles/page-title.scss";import"vuepress-shared/client";import"@vuepress/plugin-reading-time/client";import"@vuepress/helper/shared";import"@vuepress/helper/noopComponent";import"@vuepress/plugin-comment/pageview";import"../info/styles/author-info.scss";import"@vuepress/plugin-theme-data/client";import"../../styles/variables.module.scss";import"../info/styles/category-info.scss";import"../info/styles/original-info.scss";import"../info/styles/tag-info.scss";import"balloon-css/balloon.css";import"../info/styles/page-info.scss";var k=f({name:"PasswordModal",props:{hint:String,full:Boolean,showTitle:Boolean},emits:["verify"],setup(t,{emit:a}){const c=x(),u=I(),l=m(""),o=m(!1),r=m(!1),e=d(()=>u.value.encryptLocales);let i=null;const p=()=>{i&&clearTimeout(i),o.value=!1,a("verify",l.value,r.value),V().then(()=>{o.value=!0,i=setTimeout(()=>{o.value=!1},1e3)})};return()=>s("div",{class:["vp-decrypt-layer",{expand:t.full||c.value.home}]},[t.showTitle?s(D):null,s("div",{class:"vp-decrypt-modal"},[s("div",{class:["vp-decrypt-hint",{tried:o.value}]},o.value?e.value.errorHint:s(H,{"aria-label":e.value.iconLabel})),t.hint?s("div",{class:"vp-decrypt-hint"},t.hint):null,s("div",{class:"vp-decrypt-input"},[s("input",{type:"password",value:l.value,placeholder:e.value.placeholder,onInput:({target:n})=>{l.value=n.value},onKeydown:({key:n})=>{n==="Enter"&&p()}})]),s("div",{class:"vp-remember-password"},[s("input",{id:"remember-password",type:"checkbox",value:r.value,onChange:()=>{r.value=!r.value}}),s("label",{for:"remember-password"},e.value.remember)]),s("button",{type:"button",class:"vp-decrypt-submit",onClick:()=>{p()}},"OK")])])}});const L=()=>{const t=K();return d(()=>t.value.encrypt)},T="VUEPRESS_HOPE_GLOBAL_TOKEN",U=()=>{const t=L(),a=b(T,""),c=g(T,"");return{status:d(()=>{const{global:u=!1,admin:l}=t.value,o=u&&!!l?.tokens.length,r=o?a.value?t.value.admin.tokens.every(e=>!y(a.value,e)):t.value.admin.tokens.every(e=>!y(c.value,e)):!1;return{isEncrypted:o,isLocked:r,hint:l?.hint??""}}),validate:(u,l=!1)=>{(l?a:c).value=u}}},h=(t="",a)=>!!t&&y(t,a),P="VUEPRESS_HOPE_PATH_TOKEN",j=()=>{const t=C(),a=L(),c=b(P,{}),u=g(P,{}),l=r=>w(a.value.config)?S(a.value.config).filter(e=>O(decodeURI(r),e)).sort((e,i)=>i.length-e.length):[],o=r=>{const{config:e={}}=a.value,i=l(r);if(i.length>0){const p=i.find(n=>e[n].hint);return{isEncrypted:!0,isLocked:i.some(n=>(c.value[n]?e[n].tokens.every(v=>!h(c.value[n],v)):!0)&&(u.value[n]?e[n].tokens.every(v=>!h(u.value[n],v)):!0)),hint:p?e[p].hint:""}}return{isEncrypted:!1,isLocked:!1,hint:""}};return{status:d(()=>o(t.value.path)),getStatus:o,validate:(r,e=!1)=>{const{config:i={}}=a.value,p=l(t.value.path);for(const n of p)if(i[n].tokens.some(v=>h(r,v))){(e?c:u).value[n]=r;break}}}};var B=f({name:"GlobalEncrypt",slots:Object,setup(t,{slots:a}){const{status:c,validate:u}=U(),l=R(),o=m(!1);return E(()=>{o.value=!0}),()=>{const{isEncrypted:r,isLocked:e,hint:i}=c.value;return s(l.value?_:G,()=>r?o.value?e?s(k,{full:!0,hint:i,onVerify:u}):a.default():null:a.default())}}}),F=f({name:"LocalEncrypt",slots:Object,setup(t,{slots:a}){const{status:c,validate:u}=j(),l=m(!1);return E(()=>{l.value=!0}),()=>{const{isEncrypted:o,isLocked:r,hint:e}=c.value;return o?l.value?r?s(k,{showTitle:!0,full:!0,hint:e,onVerify:u}):a.default():null:a.default()}}});export{B as GlobalEncrypt,F as LocalEncrypt};
//# sourceMappingURL=export.js.map
