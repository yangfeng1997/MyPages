import{entries as x,fromEntries as q,isArray as D,keys as z,Logger as P,ensureEndingSlash as j,getPageExcerpt as F,getFullLocaleConfig as $,addViteOptimizeDepsInclude as J,addViteSsrNoExternal as M}from"@vuepress/helper";import{watch as K}from"chokidar";import{load as G}from"cheerio";import{createIndex as V,addAllAsync as W,discard as L,addAll as B,vacuum as A}from"slimsearch";import{path as w,getDirname as U,fs as R}from"vuepress/utils";const Z="h2,h3,h4,h5,h6".split(","),X="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,tfoot,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,pre".split(","),Y="routelink,routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),Q=e=>e.type==="comment"&&e.data.trim()==="more",ee=G(""),te=e=>(e.children.length===1&&e.children[0].type==="tag"&&e.children[0].tagName==="a"&&e.children[0].attribs.class==="header-anchor"&&(e.children=e.children[0].children[0].children),e.children.map(t=>t.type==="text"?t.data:null).filter(Boolean).join(" ").replace(/\s+/gu," ").trim()),C=(e,t,a=[],i=!1)=>{const{contentRendered:s,data:c,title:l}=e,n=t.addPath(e.path).toString(),d=!!c.excerpt?.length,u={id:n,h:l},o=[u];let y=d||i,h=null,g="",v=!1;const H=()=>{g&&y&&(((v?h:u).t??=[]).push(g.replace(/[\n\s]+/gu," ")),g="")},k=(r,p=!1)=>{if(r.type==="tag")if(Z.includes(r.name)){const{id:m}=r.attribs,S=te(r);H(),m?(v?o.push(h):v=!0,h={id:`${n}#${m}`,h:S}):S&&((h??u).t??=[]).push(S)}else X.includes(r.name)?(H(),r.childNodes.forEach(m=>{k(m,p||r.name==="pre")})):Y.includes(r.name)&&r.childNodes.forEach(m=>{k(m,p)});else r.type==="text"?g+=p||r.data.trim()?r.data:"":d&&!i&&Q(r)&&(y=!1)},T=ee.parseHTML(s)??[],_=q(a.map(({getter:r},p)=>{const m=r(e);return D(m)?[p.toString(),m]:m?[p.toString(),[m]]:null}).filter(r=>r!==null));return!T.length&&!z(_).length?[]:(T.forEach(r=>{k(r)}),H(),h&&o.push(h),x(_).forEach(([r,p])=>{o.push({id:`${n}@${r}`,c:p})}),o)},ae=async(e,{customFields:t,indexContent:a,filter:i=()=>!0,indexOptions:s,indexLocaleOptions:c},l)=>{const n={};e.pages.forEach(u=>{i(u)&&u.frontmatter.search!==!1&&(n[u.pathLocale]??=[]).push(...C(u,l,t,a))});const d={};return await Promise.all(x(n).map(async([u,o])=>{const y=V({...s,...c?.[u],fields:["h","t","c"],storeFields:["h","a","t","c"]});await W(y,o),d[u]=y})),d},N=import.meta.dirname||U(import.meta.url),E="@vuepress/plugin-slimsearch",ie=new P(E),re=j(w.resolve(N,"../client/")),se=w.resolve(N,"../worker/index.js"),f=e=>e.replace(/\//g,"")||"root",b=e=>e.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/README.md").replace(/\.html\.vue/,".md"),le=async(e,t,a)=>{const i=e.dir.dest(t.worker??"slimsearch.worker.js"),s=JSON.stringify(a),c=await R.readFile(se,"utf8");await R.ensureDir(w.dirname(i)),await R.writeFile(i,c.replace("__SLIMSEARCH_INDEX__",()=>JSON.stringify(s)).replace("__SLIMSEARCH_SORT_STRATEGY__",JSON.stringify(t.sortStrategy??"max")))},ne=[[["en","en-US"],{cancel:"Cancel",placeholder:"Search",search:"Search",clear:"Clear search query",remove:"Delete current item",searching:"Searching",defaultTitle:"Documentation",select:"to select",navigate:"to navigate",autocomplete:"to autocomplete",exit:"to exit",queryHistory:"Search History",resultHistory:"Result History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."}],[["zh","zh-CN","zh-Hans"],{cancel:"取消",placeholder:"搜索",search:"搜索",clear:"清除搜索文字",remove:"删除当前项目",searching:"搜索中",defaultTitle:"文档",select:"选择",navigate:"切换",autocomplete:"自动补全",exit:"关闭",queryHistory:"搜索历史",resultHistory:"历史结果",emptyHistory:"无搜索历史",emptyResult:"没有找到结果",loading:"正在加载搜索索引..."}],[["zh-TW","zh-Hant"],{cancel:"取消",placeholder:"搜索",search:"搜索",clear:"清除搜索文字",remove:"刪除當前項目",searching:"搜索中",defaultTitle:"文檔",select:"選擇",navigate:"切換",autocomplete:"自動補全",exit:"關閉",queryHistory:"搜索歷史",resultHistory:"歷史結果",emptyHistory:"無搜索歷史",emptyResult:"沒有找到結果",loading:"正在加載搜索索引..."}],[["de","de-DE"],{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",clear:"Suchanfrage löschen",remove:"Aktuellen Eintrag löschen",searching:"Suche",defaultTitle:"Dokumentation",select:"auswählen",navigate:"wechseln",autocomplete:"automatisch vervollständigen",exit:"schließen",queryHistory:"Suchverlauf",resultHistory:"Ergebnisverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."}],[["vi","vi-VN"],{cancel:"Hủy",placeholder:"Tìm kiếm",search:"Tìm kiếm",clear:"Xóa tìm kiếm",remove:"Xóa mục hiện tại",searching:"Đang tìm kiếm",defaultTitle:"Tài liệu",select:"chọn",navigate:"chuyển",autocomplete:"tự động hoàn thành",exit:"đóng",queryHistory:"Lịch sử tìm kiếm",resultHistory:"Lịch sử kết quả",emptyHistory:"Xóa lịch sử tìm kiếm",emptyResult:"Không tìm thấy kết quả",loading:"Đang tải chỉ mục tìm kiếm..."}],[["uk"],{cancel:"Скасувати",placeholder:"Пошук",search:"Пошук",clear:"очистити пошуковий запит",remove:"Видалити поточний елемент",searching:"Пошук",defaultTitle:"Документація",select:"вибрати",navigate:"перейти",autocomplete:"автозаповнення",exit:"закрити",queryHistory:"Історія пошуку",resultHistory:"Історія результатів",emptyHistory:"Очистити історію пошуку",emptyResult:"Нічого не знайдено",loading:"Завантаження пошукових індексів..."}],[["ru","ru-RU"],{cancel:"Отмена",placeholder:"Поиск",search:"Поиск",clear:"Очистить поисковый запрос",remove:"Удалить текущий элемент",searching:"Поиск",defaultTitle:"Документация",select:"выбрать",navigate:"переключить",autocomplete:"автозаполнение",exit:"закрыть",queryHistory:"История поиска",resultHistory:"История результатов",emptyHistory:"Очистить историю поиска",emptyResult:"Ничего не найдено",loading:"Загрузка поисковых индексов..."}],[["br"],{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",clear:"Limpar pesquisa",remove:"Remover item atual",searching:"Pesquisando",defaultTitle:"Documentação",select:"selecionar",navigate:"navegar",autocomplete:"autocompletar",exit:"fechar",queryHistory:"Histórico de pesquisa",resultHistory:"Histórico de resultados",emptyHistory:"Limpar histórico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando índices de pesquisa..."}],[["pl","pl-PL"],{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",clear:"Wyczyść zapytanie",remove:"Usuń bieżący element",searching:"Szukanie",defaultTitle:"Dokumentacja",select:"wybierz",navigate:"przejdź",autocomplete:"autouzupełnianie",exit:"zamknij",queryHistory:"Historia wyszukiwania",resultHistory:"Historia wyników",emptyHistory:"Wyczyść historię wyszukiwania",emptyResult:"Nie znaleziono wyników",loading:"Ładowanie indeksów wyszukiwania..."}],[["sk","sk-SK"],{cancel:"Zrušiť",placeholder:"Hľadať",search:"Hľadať",clear:"Vymazať vyhľadávanie",remove:"Odstrániť aktuálny prvok",searching:"Hľadanie",defaultTitle:"Dokumentácia",select:"vybrať",navigate:"prepnúť",autocomplete:"automatické dopĺňanie",exit:"zavrieť",queryHistory:"História vyhľadávania",resultHistory:"História výsledkov",emptyHistory:"Vymazať históriu vyhľadávania",emptyResult:"Nenašli sa žiadne výsledky",loading:"Načítavajú sa vyhľadávacie indexy..."}],[["fr","fr-FR"],{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",clear:"Effacer la recherche",remove:"Supprimer l'élément actuel",searching:"Recherche",defaultTitle:"Documentation",select:"sélectionner",navigate:"naviguer",autocomplete:"auto-complétion",exit:"fermer",queryHistory:"Historique de recherche",resultHistory:"Historique des résultats",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun résultat trouvé",loading:"Chargement des index de recherche..."}],[["es","es-ES"],{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",clear:"Limpiar búsqueda",remove:"Eliminar elemento actual",searching:"Buscando",defaultTitle:"Documentación",select:"seleccionar",navigate:"navegar",autocomplete:"autocompletar",exit:"cerrar",queryHistory:"Historial de búsqueda",resultHistory:"Historial de resultados",emptyHistory:"Vaciar historial de búsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando índices de búsqueda..."}],[["ja","ja-JP"],{cancel:"キャンセル",placeholder:"検索",search:"検索",clear:"検索文字列をクリア",remove:"現在の項目を削除",searching:"検索中",defaultTitle:"ドキュメント",select:"選択",navigate:"切り替え",autocomplete:"オートコンプリート",exit:"閉じる",queryHistory:"検索履歴",resultHistory:"結果履歴",emptyHistory:"検索履歴をクリア",emptyResult:"結果が見つかりません",loading:"検索インデックスを読み込んでいます..."}],[["tr","tr-TR"],{cancel:"İptal",placeholder:"Ara",search:"Ara",clear:"Arama metnini temizle",remove:"Geçerli öğeyi sil",searching:"Aranıyor",defaultTitle:"Dökümantasyon",select:"seç",navigate:"geç",autocomplete:"otomatik tamamlama",exit:"kapat",queryHistory:"Arama geçmişi",resultHistory:"Sonuç geçmişi",emptyHistory:"Arama geçmişini temizle",emptyResult:"Sonuç bulunamadı",loading:"Arama dizinleri yükleniyor..."}],[["ko","ko-KO"],{cancel:"취소",placeholder:"검색",search:"검색",clear:"검색어 지우기",remove:"현재 항목 삭제",searching:"검색 중",defaultTitle:"문서",select:"선택",navigate:"이동",autocomplete:"자동 완성",exit:"닫기",queryHistory:"검색 기록",resultHistory:"결과 기록",emptyHistory:"검색 기록 지우기",emptyResult:"결과를 찾을 수 없습니다",loading:"검색 인덱스를 로드하는 중..."}],[["fi","fi-FI"],{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",clear:"Tyhjennä hakukysely",remove:"Poista nykyinen kohde",searching:"Etsitään",defaultTitle:"Dokumentaatio",select:"valitaksesi",navigate:"navigoidaksesi",autocomplete:"automaattinen täydennys",exit:"poistuaksesi",queryHistory:"Hakuhistoria",resultHistory:"Tuloshistoria",emptyHistory:"Tyhjennä hakuhistoria",emptyResult:"Tuloksia ei löytynyt",loading:"Ladataan hakuindeksiä..."}],[["hu","hu-HU"],{cancel:"Mégse",placeholder:"Keresés",search:"Keresés",clear:"Keresési kifejezés törlése",remove:"Aktuális elem törlése",searching:"Keresés",defaultTitle:"Dokumentáció",select:"kiválasztáshoz",navigate:"navigáláshoz",autocomplete:"automatikus kiegészítés",exit:"kilépéshez",queryHistory:"Keresési előzmények",resultHistory:"Eredmények előzményei",emptyHistory:"Üres keresési előzmények",emptyResult:"Nincs találat",loading:"A keresési indexek betöltése..."}],[["id","id-ID"],{cancel:"Batal",placeholder:"Cari sesuatu",search:"Cari",clear:"Hapus pencarian",remove:"Hapus item saat ini",searching:"Sedang mencari",defaultTitle:"Dokumentasi",select:"pilih",navigate:"navigasi",autocomplete:"autoselesai",exit:"keluar",queryHistory:"Riwayat Penelusuran",resultHistory:"Riwayat Hasil",emptyHistory:"Tidak ada riwayat penelusuran",emptyResult:"Hasil penelusuran tidak tersedia",loading:"Memuat indeks penelusuran..."}],[["nl","nl-NL"],{cancel:"Annuleren",placeholder:"Zoeken",search:"Zoeken",clear:"Zoekopdracht wissen",remove:"Verwijder huidig item",searching:"Zoeken",defaultTitle:"Documentatie",select:"Selecteren",navigate:"to navigate",autocomplete:"autocompletion",exit:"to exit",queryHistory:"Zoekgeschiedenis",resultHistory:"Resultaatgeschiedenis",emptyHistory:"Zoekgeschiedenis Leegmaken",emptyResult:"Geen resultaten gevonden",loading:"Laden van zoekindexen..."}]];class oe{store;constructor(){this.store=[]}addPath(t){const a=this.store.indexOf(t);return a===-1?(this.store.push(t),this.store.length-1):a}addPaths(t){return t.map(a=>this.addPath(a))}deletePath(t){const a=this.store.indexOf(t);a!==-1&&(this.store[a]="")}clear(){this.store=[]}toJSON(){return JSON.stringify(this.store)}}const ce=async(e,t)=>{await e.writeTemp("slimsearch/store.js",`export const store = ${t.toJSON()};
`)},ue=async(e,t)=>{await Promise.all(x(t).map(([a,i])=>e.writeTemp(`slimsearch/${f(a)}.js`,`export default ${JSON.stringify(JSON.stringify(i))};`))),await e.writeTemp("slimsearch/index.js",`export default {${z(t).map(a=>`${JSON.stringify(a)}: () => import('./${f(a)}.js')`).join(",")}}`)},O=async(e,t,a,i,s)=>{const c=b(s),l=e.pages.find(({filePathRelative:n})=>n?.toLowerCase()===c.toLowerCase());if(l){const n=C(l,i,t.customFields,t.indexContent),{pathLocale:d}=l,u=i.addPath(l.path).toString(),o=a[d];Array.from(o._documentIds.values()).filter(h=>h.startsWith(u)).forEach(h=>{L(o,h)}),B(o,n),await A(o);const y=`export default ${JSON.stringify(JSON.stringify(o))}
`;await e.writeTemp(`slimsearch/${f(d)}.js`,y)}},de=async(e,t,a,i)=>{const s=b(i),c=e.pages.find(({filePathRelative:l})=>l?.toLowerCase()===s.toLowerCase());if(c){const{pathLocale:l}=c,n=a.addPath(c.path).toString(),d=t[l];Array.from(d._documentIds.values()).filter(o=>o.startsWith(n)).forEach(o=>{L(d,o)}),await A(d);const u=`export default ${JSON.stringify(JSON.stringify(d))}
`;await e.writeTemp(`slimsearch/${f(l)}.js`,u)}},me=e=>{const{pages:t,pluginApi:a}=e;a.plugins.some(({name:i})=>i==="@vuepress/plugin-blog")||t.some(i=>"excerpt"in i.data)||t.forEach(i=>{i.data.excerpt=F(e,i,{length:300})})},he=(e={})=>t=>{t.env.isDebug&&ie.info("Options:",e);const a=new oe;let i=null;return{name:E,define:{__SLIMSEARCH_SUGGESTION__:e.suggestion??!0,__SLIMSEARCH_CUSTOM_FIELDS__:q(e.customFields?.map(({formatter:s},c)=>s?[c.toString(),s]:null).filter(s=>s!==null)??[]),__SLIMSEARCH_LOCALES__:$({app:t,name:E,config:e.locales,default:ne}),__SLIMSEARCH_OPTIONS__:{searchDelay:e.searchDelay??150,suggestDelay:e.suggestDelay??0,queryHistoryCount:e.queryHistoryCount??5,resultHistoryCount:e.resultHistoryCount??5,hotKeys:e.hotKeys??[{key:"k",ctrl:!0},{key:"/",ctrl:!0}],worker:e.worker??"slimsearch.worker.js"},__SLIMSEARCH_SORT_STRATEGY__:JSON.stringify(e.sortStrategy??"max")},clientConfigFile:`${re}config.js`,extendsBundlerOptions:s=>{J(s,t,"slimsearch",!0),M(s,t,["@vuepress/helper","fflate","vuepress-shared"])},onInitialized:async()=>{me(t),i=await ae(t,e,a)},onPrepared:async()=>{t.env.isDev&&await ue(t,i),await ce(t,a),t.env.isBuild&&a.clear()},onWatched:(s,c)=>{if(e.hotReload??t.env.isDebug){const l=K("pages/**/*.vue",{cwd:t.dir.temp(),ignoreInitial:!0});l.on("add",n=>{O(t,e,i,a,n)}),l.on("change",n=>{O(t,e,i,a,n)}),l.on("unlink",n=>{de(t,i,a,n)}),c.push(l)}},onGenerated:()=>le(t,e,i)}};var I=(e=>(e.Heading="h",e.Anchor="a",e.Text="t",e.CustomFields="c",e))(I||{});export{I as IndexField,he as slimsearchPlugin};
//# sourceMappingURL=index.js.map
