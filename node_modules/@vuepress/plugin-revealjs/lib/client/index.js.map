{"version":3,"file":"index.js","sources":["../../src/client/helpers/revealJs.ts","../../src/client/components/RevealJs.ts"],"sourcesContent":["import { watchImmediate } from '@vueuse/core'\n// eslint-disable-next-line import/no-rename-default\nimport type Reveal from 'reveal.js'\nimport type { App, InjectionKey, MaybeRefOrGetter, Ref } from 'vue'\nimport { computed, inject, isRef, ref } from 'vue'\nimport { isFunction } from 'vuepress/shared'\n\ndeclare const __VUEPRESS_DEV__: boolean\n\nexport type RevealJsOptions = Partial<Omit<Reveal.Options, 'embedded'>>\n\nexport type RevealJsOptionsRef = Ref<RevealJsOptions>\n\nconst revealOptions: RevealJsOptionsRef = ref({})\n\nconst revealJsSymbol: InjectionKey<RevealJsOptionsRef> = Symbol(\n  __VUEPRESS_DEV__ ? 'revealjs' : '',\n)\n\nexport const defineRevealJsConfig = (\n  options: MaybeRefOrGetter<RevealJsOptions>,\n): void => {\n  if (isRef(options)) {\n    watchImmediate(\n      () => options.value,\n      (value) => {\n        revealOptions.value = value\n      },\n    )\n  } else if (isFunction(options)) {\n    watchImmediate(computed(options), (value) => {\n      revealOptions.value = value\n    })\n  } else {\n    revealOptions.value = options\n  }\n}\n\nexport const useRevealJsConfig = (): RevealJsOptionsRef =>\n  inject(revealJsSymbol)!\n\nexport const injectRevealJsConfig = (app: App): void => {\n  app.provide(revealJsSymbol, revealOptions)\n}\n","import { useRevealJs } from '@temp/revealjs/index.js'\nimport { LoadingIcon, decodeData } from '@vuepress/helper/client'\n// eslint-disable-next-line import/no-rename-default\nimport type Reveal from 'reveal.js/dist/reveal.esm.js'\nimport type { PropType, VNode } from 'vue'\nimport {\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport {\n  onContentUpdated,\n  usePageFrontmatter,\n  usePageLayout,\n} from 'vuepress/client'\n\nimport type { RevealJsTheme } from '../../shared/index.js'\nimport { useRevealJsConfig } from '../helpers/index.js'\n\nimport '../styles/reveal-js.css'\n\nexport const RevealJs = defineComponent({\n  name: 'RevealJs',\n\n  props: {\n    /**\n     * Presentation id\n     *\n     * 幻灯片 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Presentation code\n     *\n     * 幻灯片代码\n     */\n    code: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Presentation theme\n     *\n     * 幻灯片主题\n     */\n    theme: {\n      type: String as PropType<RevealJsTheme>,\n      default: 'auto',\n    },\n  },\n\n  setup(props) {\n    const revealOptions = useRevealJsConfig()\n    const frontmatter = usePageFrontmatter<{ revealJs: Reveal.Options }>()\n    const layout = usePageLayout()\n\n    const loading = ref(true)\n    const presentationContainer = shallowRef<HTMLElement>()\n\n    const code = computed(() => decodeData(props.code))\n\n    let reveal: Reveal.Api | null = null\n\n    const renderRevealJs = async (\n      container: HTMLElement,\n    ): Promise<Reveal.Api> => {\n      const [Reveal, ...plugins] = await useRevealJs()\n\n      const isSlidePage = layout.value.name === 'SlidePage'\n\n      const instance = new Reveal(container, {\n        backgroundTransition: 'slide',\n        transition: 'slide',\n        slideNumber: true,\n        ...revealOptions.value,\n        hash: isSlidePage,\n        mouseWheel: isSlidePage,\n        ...frontmatter.value.revealJs,\n        embedded: !isSlidePage,\n        keyboardCondition: isSlidePage ? null : 'focused',\n        markdown: {\n          separator: '^\\r?\\\\n---\\r?\\n$',\n          verticalSeparator: '^\\r?\\n--\\r?\\n$',\n        },\n\n        plugins: [plugins, revealOptions.value.plugins ?? []].flat(),\n      })\n\n      await instance.initialize()\n\n      return instance\n    }\n\n    const initRevealJs = async (): Promise<void> => {\n      const container = presentationContainer.value\n\n      if (container) {\n        container.setAttribute('id', props.id)\n        container.setAttribute('data-theme', props.theme)\n\n        loading.value = true\n\n        reveal = await renderRevealJs(container)\n\n        loading.value = false\n      }\n    }\n\n    onContentUpdated(async (reason) => {\n      if (reason === 'mounted') await initRevealJs()\n    })\n\n    onMounted(() => {\n      watch(code, initRevealJs, { flush: 'post' })\n    })\n\n    onUnmounted(() => {\n      reveal?.destroy()\n    })\n\n    return (): VNode =>\n      h('div', { class: 'vp-reveal' }, [\n        h(\n          'div',\n          {\n            ref: presentationContainer,\n            class: ['reveal', 'reveal-viewport'],\n          },\n          h('div', {\n            class: 'slides',\n            innerHTML: `<section data-markdown><script type=\"text/template\">${code.value}</script></section>`,\n          }),\n        ),\n        loading.value\n          ? h(LoadingIcon, { class: 'reveal-loading', height: 400 })\n          : null,\n      ])\n  },\n})\n"],"names":["revealOptions","ref","revealJsSymbol","defineRevealJsConfig","options","isRef","watchImmediate","value","isFunction","computed","useRevealJsConfig","inject","injectRevealJsConfig","app","RevealJs","defineComponent","props","frontmatter","usePageFrontmatter","layout","usePageLayout","loading","presentationContainer","shallowRef","code","decodeData","reveal","renderRevealJs","container","Reveal","plugins","useRevealJs","isSlidePage","instance","initRevealJs","onContentUpdated","reason","onMounted","watch","onUnmounted","h","LoadingIcon"],"mappings":"0eAaA,MAAMA,EAAoCC,EAAI,EAAE,EAE1CC,EAAmD,OACvD,iBAAmB,WAAa,EAClC,EAEaC,EACXC,GACS,CACLC,EAAMD,CAAO,EACfE,EACE,IAAMF,EAAQ,MACbG,GAAU,CACTP,EAAc,MAAQO,CACxB,CACF,EACSC,EAAWJ,CAAO,EAC3BE,EAAeG,EAASL,CAAO,EAAIG,GAAU,CAC3CP,EAAc,MAAQO,CACxB,CAAC,EAEDP,EAAc,MAAQI,CAE1B,EAEaM,EAAoB,IAC/BC,EAAOT,CAAc,EAEVU,EAAwBC,GAAmB,CACtDA,EAAI,QAAQX,EAAgBF,CAAa,CAC3C,ECjBac,EAAWC,EAAgB,CACtC,KAAM,WAEN,MAAO,CAML,GAAI,CACF,KAAM,OACN,SAAU,EACZ,EAOA,KAAM,CACJ,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,CACL,KAAM,OACN,QAAS,MACX,CACF,EAEA,MAAMC,EAAO,CACX,MAAMhB,EAAgBU,EAAkB,EAClCO,EAAcC,IACdC,EAASC,IAETC,EAAUpB,EAAI,EAAI,EAClBqB,EAAwBC,EAAAA,EAExBC,EAAOf,EAAS,IAAMgB,EAAWT,EAAM,IAAI,CAAC,EAElD,IAAIU,EAA4B,KAEhC,MAAMC,EAAiB,MACrBC,GACwB,CACxB,KAAM,CAACC,EAAQ,GAAGC,CAAO,EAAI,MAAMC,IAE7BC,EAAcb,EAAO,MAAM,OAAS,YAEpCc,EAAW,IAAIJ,EAAOD,EAAW,CACrC,qBAAsB,QACtB,WAAY,QACZ,YAAa,GACb,GAAG5B,EAAc,MACjB,KAAMgC,EACN,WAAYA,EACZ,GAAGf,EAAY,MAAM,SACrB,SAAU,CAACe,EACX,kBAAmBA,EAAc,KAAO,UACxC,SAAU,CACR,UAAW;AAAA,GACX,kBAAmB;AAAA;AAAA,EACrB,EAEA,QAAS,CAACF,EAAS9B,EAAc,MAAM,SAAW,CAAE,CAAA,EAAE,MACxD,CAAC,EAED,OAAA,MAAMiC,EAAS,WAAA,EAERA,CACT,EAEMC,EAAe,SAA2B,CAC9C,MAAMN,EAAYN,EAAsB,MAEpCM,IACFA,EAAU,aAAa,KAAMZ,EAAM,EAAE,EACrCY,EAAU,aAAa,aAAcZ,EAAM,KAAK,EAEhDK,EAAQ,MAAQ,GAEhBK,EAAS,MAAMC,EAAeC,CAAS,EAEvCP,EAAQ,MAAQ,GAEpB,EAEA,OAAAc,EAAiB,MAAOC,GAAW,CAC7BA,IAAW,WAAW,MAAMF,EAClC,CAAA,CAAC,EAEDG,EAAU,IAAM,CACdC,EAAMd,EAAMU,EAAc,CAAE,MAAO,MAAO,CAAC,CAC7C,CAAC,EAEDK,EAAY,IAAM,CAChBb,GAAQ,QAAQ,CAClB,CAAC,EAEM,IACLc,EAAE,MAAO,CAAE,MAAO,WAAY,EAAG,CAC/BA,EACE,MACA,CACE,IAAKlB,EACL,MAAO,CAAC,SAAU,iBAAiB,CACrC,EACAkB,EAAE,MAAO,CACP,MAAO,SACP,UAAW,uDAAuDhB,EAAK,KAAK,sBAC9E,CAAC,CACH,EACAH,EAAQ,MACJmB,EAAEC,EAAa,CAAE,MAAO,iBAAkB,OAAQ,GAAI,CAAC,EACvD,IACN,CAAC,CACL,CACF,CAAC"}